local Players = game:GetService("Players")
local speaker = Players.LocalPlayer

-- Load Rayfield Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
Rayfield:LoadConfiguration()

-- Create Main Window
local Window = Rayfield:CreateWindow({
    Name = "XCUBE Window",
    Icon = 0,
    LoadingTitle = "XCUBE",
    LoadingSubtitle = "by Sirius | SCRIPT BY XCUBE",
    Theme = "Default",
    DisableRayfieldPrompts = false,
    DisableBuildWarnings = false,
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "XCUBE_Animations",
        FileName = "SavedAnimations"
    },
    KeySystem = false
})

-- Load Saved Animations
local Animations = {
    Idle = {"", ""},
    Walk = "",
    Run = "",
    Jump = "",
    Fall = "",
    SwimIdle = "",
    Swim = "",
    Climb = ""
}

-- Load from File (If Exists)
if isfile("XCUBE_Animations/SavedAnimations.json") then
    local savedData = game:GetService("HttpService"):JSONDecode(readfile("XCUBE_Animations/SavedAnimations.json"))
    Animations = savedData
end

-- Function to Save Last Used Animations
local function saveLastAnimations()
    writefile("XCUBE_Animations/SavedAnimations.json", game:GetService("HttpService"):JSONEncode(Animations))
end

-- Function to Apply Animations
local function applyAnimation(animationType, animationId)
    local Char = speaker.Character
    if not Char then return end

    local Animate = Char:FindFirstChild("Animate")
    if not Animate then return end

    if animationType == "Idle" and animationId[1] ~= "" and animationId[2] ~= "" then
        Animate.idle.Animation1.AnimationId = "http://www.roblox.com/asset/?id=" .. animationId[1]
        Animate.idle.Animation2.AnimationId = "http://www.roblox.com/asset/?id=" .. animationId[2]
    elseif animationType ~= "Idle" and animationId ~= "" then
        Animate[animationType:lower()][animationType .. "Anim"].AnimationId = "http://www.roblox.com/asset/?id=" .. animationId
    end
end

-- Auto-Apply Saved Animations When Script Loads
for animationType, animationId in pairs(Animations) do
    if animationId ~= "" then
        applyAnimation(animationType, animationId)
    end
end

-- Auto-Reapply Custom Animations on Respawn
speaker.CharacterAdded:Connect(function()
    task.wait(1)
    for animationType, animationId in pairs(Animations) do
        if animationId ~= "" then
            applyAnimation(animationType, animationId)
        end
    end
end)

-- Custom Animation Inputs
local CustomAniTab = Window:CreateTab("Custom-ani", 4483362458)

CustomAniTab:CreateInput({
    Name = "Idle 1 Animation ID",
    PlaceholderText = "Enter Idle 1 Animation ID",
    RemoveTextAfterFocusLost = false,
    Default = Animations.Idle[1],
    Callback = function(value)
        Animations.Idle[1] = value
        saveLastAnimations()
        applyAnimation("Idle", Animations.Idle)
    end
})

CustomAniTab:CreateInput({
    Name = "Idle 2 Animation ID",
    PlaceholderText = "Enter Idle 2 Animation ID",
    RemoveTextAfterFocusLost = false,
    Default = Animations.Idle[2],
    Callback = function(value)
        Animations.Idle[2] = value
        saveLastAnimations()
        applyAnimation("Idle", Animations.Idle)
    end
})

for _, animType in ipairs({"Walk", "Run", "Jump", "Fall", "SwimIdle", "Swim", "Climb"}) do
    CustomAniTab:CreateInput({
        Name = animType .. " Animation ID",
        PlaceholderText = "Enter " .. animType .. " Animation ID",
        RemoveTextAfterFocusLost = false,
        Default = Animations[animType],
        Callback = function(value)
            Animations[animType] = value
            saveLastAnimations()
            applyAnimation(animType, value)
        end
    })
end
